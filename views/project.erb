<!DOCTYPE html> 
<html> 
  <head> 
    <title>Donut Chart</title> 
    <script type="text/javascript" src="/js/d3.js"></script> 
    <script type="text/javascript" src="/js/d3.layout.js"></script> 
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js" type="text/javascript"></script>
    <style type="text/css"> 

      body {
        font: 10px sans-serif;
      }

    </style> 
  </head> 
  <body>
    <script type="text/javascript"> 
      data = $.get('http://localhost:9292/' + '<%= @username %>'  + '/' + '<%= @project %>' + '/committers.json', function(fetched_data) {
          
        var w = 300,
        h = 300,
        r = Math.min(w, h) / 2,
        data = fetched_data,
        color = d3.scale.category20(),
        arc = d3.svg.arc().innerRadius(r * .6).outerRadius(r),
        donut = d3.layout.pie()
        //.sort(d3.descending);


        var vis = d3.select("body")
        .append("svg:svg")
        .data([data.map(function(d) { return d.total })])
        .attr("width", w)
        .attr("height", h);

        var arcs = vis.selectAll("g.arc")
        .data(donut)
        .enter().append("svg:g")
        .attr("class", "arc")
        .attr("transform", "translate(" + r + "," + r + ")");

        arcs.append("svg:path")
        .attr("fill", function(d, i) { return color(i); })
        .attr("d", arc);

        arcs.append("svg:text")
        .attr("transform", function(d) { return "translate(" + arc.centroid(d) + ")"; })
        .attr("dy", ".35em")
        .attr("text-anchor", "middle");

        $(fetched_data).each(function(i, obj) {
          $('ul').append('<li style="color:' + color(i) + '">' + obj.name + '</li>');
        });
      });
      </script> 
    <ul></ul>
    </body>
  </html>
